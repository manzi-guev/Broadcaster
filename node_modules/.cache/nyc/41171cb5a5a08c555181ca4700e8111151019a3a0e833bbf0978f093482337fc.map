{"version":3,"sources":["token.middleware.js"],"names":["checkToken","req","res","next","takeToken","header","status","json","error","jwt","verify","process","env","KEY","email","findUser","con","query","users","rowCount","message"],"mappings":";;;;;;AAGA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAa,eAAbA,UAAa,CAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,EAA0B;AAC3C,MAAI;AACF,QAAMC,YAAYH,IAAII,MAAJ,CAAW,OAAX,CAAlB;AACA,QAAI,CAACD,SAAL,EAAgB;AACd,aAAOF,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,gBAAQ,GADkB;AAE1BE,eAAO;AAFmB,OAArB,CAAP;AAID;;AAPC,sBAQgBC,uBAAIC,MAAJ,CAAWT,IAAII,MAAJ,CAAW,OAAX,CAAX,EAAgCM,QAAQC,GAAR,CAAYC,GAA5C,CARhB;AAAA,QAQMC,KARN,eAQMA,KARN;;AASF,QAAMC,WAAW,MAAMC,qBAAIC,KAAJ,CAAUC,gBAAMH,QAAhB,EAA0B,CAACD,KAAD,CAA1B,CAAvB;AACA,QAAIC,SAASI,QAAT,KAAsB,CAA1B,EAA6B;AAC3B,aAAOjB,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,gBAAQ,GADkB;AAE1BE,eAAO;AAFmB,OAArB,CAAP;AAID;AACDL;AACD,GAjBD,CAiBE,OAAOK,KAAP,EAAc;AACd,WAAON,IAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,cAAQ,GADkB;AAE1BE,aAAOA,MAAMY;AAFa,KAArB,CAAP;AAID;AACF,CAxBD,C,CAPA;AACA;AACA;kBA8BepB,U","file":"token.middleware.js","sourceRoot":"C:/Users/CharisUAS/Desktop/Broadcaster/server/v2/middleware","sourcesContent":["/* eslint-disable no-unused-vars */\r\n/* eslint-disable consistent-return */\r\n/* eslint-disable node/no-unsupported-features/es-syntax */\r\nimport jwt from 'jsonwebtoken';\r\nimport con from '../db/connection';\r\nimport users from '../models/users';\r\n\r\nconst checkToken = async (req, res, next) => {\r\n  try {\r\n    const takeToken = req.header('token');\r\n    if (!takeToken) {\r\n      return res.status(401).json({\r\n        status: 401,\r\n        error: 'No token found'\r\n      });\r\n    }\r\n    const { email } = jwt.verify(req.header('token'), process.env.KEY);\r\n    const findUser = await con.query(users.findUser, [email]);\r\n    if (findUser.rowCount === 0) {\r\n      return res.status(401).json({\r\n        status: 401,\r\n        error: 'Not authorized'\r\n      });\r\n    }\r\n    next();\r\n  } catch (error) {\r\n    return res.status(400).json({\r\n      status: 400,\r\n      error: error.message\r\n    });\r\n  }\r\n};\r\nexport default checkToken;\r\n"]}