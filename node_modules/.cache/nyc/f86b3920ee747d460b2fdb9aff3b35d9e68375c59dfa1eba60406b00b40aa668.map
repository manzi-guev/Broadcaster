{"version":3,"sources":["isadmin.js"],"names":["access","req","res","next","id","parseInt","params","foundredflag","con","query","redflags","findspecific","rowCount","status","json","error","jwt","verify","header","process","env","KEY","email","findadmin","users","findUser","rows","role"],"mappings":";;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAJA;AAMA,IAAMA,SAAS,eAATA,MAAS,CAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,EAA0B;AACvC,MAAMC,KAAKC,SAASJ,IAAIK,MAAJ,CAAWF,EAApB,EAAwB,EAAxB,CAAX;AACA,MAAMG,eAAe,MAAMC,qBAAIC,KAAJ,CAAUC,mBAASC,YAAnB,EAAiC,CAACP,EAAD,CAAjC,CAA3B;AACA,MAAIG,aAAaK,QAAb,KAA0B,CAA9B,EAAiC;AAC/B,WAAOV,IAAIW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,cAAQ,GADkB;AAE1BE,aAAO;AAFmB,KAArB,CAAP;AAID;;AARsC,oBASrBC,uBAAIC,MAAJ,CAAWhB,IAAIiB,MAAJ,CAAW,OAAX,CAAX,EAAgCC,QAAQC,GAAR,CAAYC,GAA5C,CATqB;AAAA,MAS/BC,KAT+B,eAS/BA,KAT+B;;AAUvC,MAAMC,YAAY,MAAMf,qBAAIC,KAAJ,CAAUe,gBAAMC,QAAhB,EAA0B,CAACH,KAAD,CAA1B,CAAxB;AACA,MAAIC,UAAUG,IAAV,CAAe,CAAf,EAAkBC,IAAlB,KAA2B,OAA/B,EAAwC;AACtC,WAAOzB,IAAIW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,cAAQ,GADkB;AAE1BE,aAAO;AAFmB,KAArB,CAAP;AAID;AACD,SAAOZ,MAAP;AACD,CAlBD;kBAmBeH,M","file":"isadmin.js","sourceRoot":"C:/Users/CharisUAS/Desktop/Broadcaster/server/v2/middleware","sourcesContent":["/* eslint-disable node/no-unsupported-features/es-syntax */\r\nimport jwt from 'jsonwebtoken';\r\nimport con from '../db/connection';\r\nimport users from '../models/users';\r\nimport redflags from '../models/redflags';\r\n\r\nconst access = async (req, res, next) => {\r\n  const id = parseInt(req.params.id, 10);\r\n  const foundredflag = await con.query(redflags.findspecific, [id]);\r\n  if (foundredflag.rowCount !== 1) {\r\n    return res.status(404).json({\r\n      status: 404,\r\n      error: 'Redflag not found'\r\n    });\r\n  }\r\n  const { email } = jwt.verify(req.header('token'), process.env.KEY);\r\n  const findadmin = await con.query(users.findUser, [email]);\r\n  if (findadmin.rows[0].role !== 'admin') {\r\n    return res.status(403).json({\r\n      status: 403,\r\n      error: 'You are not the Admin'\r\n    });\r\n  }\r\n  return next();\r\n};\r\nexport default access;\r\n"]}