{"version":3,"sources":["owner.js"],"names":["access","req","res","next","email","header","id","parseInt","params","foundredflag","con","query","redflags","findspecific","rowCount","status","json","error","owner","findowner"],"mappings":";;;;;;AAEA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,eAATA,MAAS,CAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,EAA0B;AACvC,MAAMC,QAAQ,qBAASH,IAAII,MAAJ,CAAW,OAAX,CAAT,CAAd;AACA,MAAMC,KAAKC,SAASN,IAAIO,MAAJ,CAAWF,EAApB,EAAwB,EAAxB,CAAX;AACA,MAAMG,eAAe,MAAMC,qBAAIC,KAAJ,CAAUC,mBAASC,YAAnB,EAAiC,CAACP,EAAD,CAAjC,CAA3B;AACA,MAAIG,aAAaK,QAAb,KAA0B,CAA9B,EAAiC;AAC/B,WAAOZ,IAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,cAAQ,GADkB;AAE1BE,aAAO;AAFmB,KAArB,CAAP;AAID;AACD,MAAMC,QAAQ,MAAMR,qBAAIC,KAAJ,CAAUC,mBAASO,SAAnB,EAA8B,CAACf,KAAD,CAA9B,CAApB;AACA,MAAI,CAACc,MAAMJ,QAAX,EAAqB;AACnB,WAAOZ,IAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BD,cAAQ,GADkB;AAE1BE,aAAO;AAFmB,KAArB,CAAP;AAID;AACDd;AACD,CAlBD,C,CANA;AACA;kBAyBeH,M","file":"owner.js","sourceRoot":"C:/Users/CharisUAS/Desktop/Broadcaster/server/v2/middleware","sourcesContent":["/* eslint-disable consistent-return */\r\n/* eslint-disable node/no-unsupported-features/es-syntax */\r\nimport con from '../db/connection';\r\nimport verifier from '../helpers/token.verifier';\r\nimport redflags from '../models/redflags';\r\n\r\nconst access = async (req, res, next) => {\r\n  const email = verifier(req.header('token'));\r\n  const id = parseInt(req.params.id, 10);\r\n  const foundredflag = await con.query(redflags.findspecific, [id]);\r\n  if (foundredflag.rowCount !== 1) {\r\n    return res.status(404).json({\r\n      status: 404,\r\n      error: 'Redflag not found'\r\n    });\r\n  }\r\n  const owner = await con.query(redflags.findowner, [email]);\r\n  if (!owner.rowCount) {\r\n    return res.status(403).json({\r\n      status: 403,\r\n      error: 'You are not the owner'\r\n    });\r\n  }\r\n  next();\r\n};\r\n\r\nexport default access;\r\n"]}